import os
import csv
import sys

csv.field_size_limit(sys.maxsize)

def search_terms_in_csv(folder_path, search_terms, output_file):
    # Crie uma lista para armazenar os resultados
    results = []
    total_terms_found = 0
    not_found = []

    # Loop através de todos os arquivos na pasta
    for filename in os.listdir(folder_path):
        if filename.endswith(".csv"):
            file_path = os.path.join(folder_path, filename)
            terms_found_in_file = 0
            terms_not_found = set(search_terms)
            
            # Log do arquivo que está sendo processado
            print(f"Processando arquivo: {filename}")
            
            # Abra o arquivo CSV e crie um leitor de CSV pode ser mudado o encoding para 'utf-8-sig' se necessário
            #Também pode ser mudado o delimitador do csv.reader para outro caractere, por exemplo csv.reader(csvfile, delimiter=';')
            with open(file_path, mode='r', encoding='latin1') as csvfile:
                csvreader = csv.reader(csvfile, delimiter='|')
                
                # Loop através de cada linha no arquivo CSV
                for row in csvreader:
                    # Verifique se algum dos termos de busca está na linha
                    for term in search_terms:
                        if term in row:
                            # Adicione o nome do arquivo e a linha aos resultados
                            results.append([filename] + row)
                            terms_found_in_file += 1
                            if term in terms_not_found:
                                terms_not_found.remove(term)

            # Adicione os termos não encontrados à lista de não encontrados
            for term in terms_not_found:
                adjusted_filename = filename[5:8]
                not_found.append([term, adjusted_filename])
                

            # Log do arquivo processado e termos encontrados
            if terms_found_in_file > 0:
                print(f"Arquivo processado: {filename}, termos encontrados: {terms_found_in_file}")
            else:
                print(f"Arquivo processado: {filename}, nenhum termo encontrado")
            total_terms_found += terms_found_in_file
    
            # Escreva os resultados no arquivo CSV de saída
            with open(output_file, mode='w', newline='', encoding='utf-8-sig') as outfile:
                csvwriter = csv.writer(outfile)
                csvwriter.writerow(["Filename", "Row Data"])
                csvwriter.writerows(results)

            # Escreva os termos não encontrados no arquivo CSV de saída
            with open('termos_nao_encontrados.csv', mode='w', newline='', encoding='utf-8-sig') as not_found_file:
                csvwriter = csv.writer(not_found_file)
                csvwriter.writerow(["Term", "Filename"])
                csvwriter.writerows(not_found)

            # Log do arquivo processado e termos encontrados
            if terms_found_in_file > 0:
                print(f"Arquivo processado: {filename}, termos encontrados do NOTFOUND: {terms_found_in_file}")
            else:
                print(f"Arquivo processado: {filename}, nenhum termo encontrado")
            total_terms_found += terms_found_in_file
    
    # Escreva os resultados no arquivo CSV de saída
    with open(output_file, mode='w', newline='', encoding='utf-8-sig') as outfile:
        csvwriter = csv.writer(outfile)
        csvwriter.writerow(["Filename", "Row Data"])
        csvwriter.writerows(results)

    # Log do total de termos encontrados
    if total_terms_found > 0:
        print(f"Total de termos encontrados: {total_terms_found}")
    else:
        print("Nenhum termo encontrado em nenhum arquivo")

# Defina o caminho da pasta onde os arquivos CSV estão localizados
folder_path = 'C:\\Users\\OSuper\\Desktop\\CIART20250130'

# Defina a lista de termos para procurar
# A pesquisa do precisa ser exata ou seja se tiver zeros a esquerda precisa ter na consulta
search_terms = [
    '000000000003099652','000000000003102755','000000000003102752','000000000003102751','000000000003102746','000000000003102744','000000000003102743','000000000003102737','000000000003102736','000000000003102679','000000000003102678','000000000003102676','000000000003102675','000000000003102671','000000000003102669','000000000003102667','000000000003102665','000000000003102662','000000000003102661','000000000003102658','000000000003102657','000000000003102656','000000000003102655','000000000003102654','000000000003102652','000000000003102651','000000000003102649','000000000003102646','000000000003102645','000000000003102639','000000000003102637','000000000003102636','000000000003102627','000000000003102619','000000000003102609','000000000003102605','000000000003102599','000000000003102529','000000000003102517','000000000003102501','000000000003106241','000000000003106004','000000000003106000','000000000003105999','000000000003105998','000000000003105940','000000000003105925','000000000003105922','000000000003105921','000000000003107563','000000000003108088','000000000003108086','000000000003108081','000000000003109884','000000000003109882','000000000003109880','000000000003109878','000000000003109877','000000000003109876','000000000003109875','000000000003109867','000000000003145915','000000000003154718','000000000003161304','000000000003161285','000000000003213633','000000000003217675','000000000003220050','000000000003221340','000000000003256685','000000000003260912','000000000003262646','000000000003269426','000000000003269421','000000000003269418','000000000003277370','000000000003277359','000000000003279521','000000000003280067','000000000003295884','000000000003295881','000000000003295874','000000000003297384','000000000003302183','000000000003302182','000000000003302181','000000000003301749','000000000003326597','000000000003326596','000000000003364708','000000000003364707','000000000003364706','000000000003364705','000000000003364704','000000000003365080','000000000003376853','000000000003391540','000000000003392290','000000000003407732','000000000003458689','000000000003458688','000000000003458686','000000000003458685','000000000003458684','000000000003458683','000000000003532960','000000000003532949','000000000003532948','000000000003532945','000000000003532944','000000000003532943','000000000003532941','000000000003532940','000000000003532938','000000000003532937','000000000003532935','000000000003532930','000000000003532919','000000000003532918','000000000003532917','000000000003532916','000000000003534412','000000000003534411','000000000003536205','000000000003537323','000000000003537322','000000000003538811','000000000003595262','000000000003595159','000000000003598295','000000000003598294','000000000003599597','000000000003599596','000000000003604263','000000000003607649','000000000003607648','000000000003607647','000000000003609663','000000000003609662','000000000003609661','000000000003609660','000000000003608829','000000000003640322','000000000003640321','000000000003640320','000000000003667269','000000000003671103','000000000003672417','000000000003672416','000000000003672415','000000000003672414','000000000003685625','000000000003695865','000000000003695864','000000000003695863','000000000003695862','000000000003695861','000000000003695860','000000000003695739','000000000003695738','000000000003716726','000000000003716724','000000000003716723','000000000003716722','000000000003716721','000000000003716720','000000000003753299','000000000003753298','000000000003753296','000000000003807152','000000000003814127','000000000003815548','000000000003818177','000000000003818176','000000000003818175','000000000003821664','000000000003106003','000000000003105853','000000000003205125','000000000003205055','000000000003205425','000000000003205404','000000000003205401','000000000003205400','000000000003205398','000000000003205397','000000000003205394','000000000003206139','000000000003206138','000000000003206124','000000000003206122','000000000003206121','000000000003206109','000000000003278526','000000000003278412','000000000003313100','000000000003391459','000000000003431691','000000000003431669','000000000003630018','000000000003630670','000000000003679042','000000000003697242','000000000003734256','000000000003734255','000000000003737251','000000000003742002','000000000003763198','000000000003769901','000000000003769887','000000000003769886','000000000003769881','000000000003769877','000000000003769874','000000000003769871','000000000003768918','000000000003770878','000000000003775928','000000000003786224','000000000003817674','000000000003159290','000000000003205079','000000000003206659','000000000003206658','000000000003206656','000000000003226668','000000000003279406','000000000003691109','000000000003705138','000000000003705136','000000000003705396','000000000003713383','000000000003713382','000000000003713381','000000000003713380','000000000003713379','000000000003716155','000000000003716154','000000000003716153','000000000003716152','000000000003716151','000000000003716150','000000000003716149','000000000003716147','000000000003716146','000000000003716145','000000000003718881','000000000003722291','000000000003728204','000000000003728203','000000000003760173','000000000003769889','000000000003799009','000000000003799002','000000000003799000','000000000003770879','000000000003303409','000000000003318910','000000000003444603','000000000003630033','000000000003630032','000000000003630031','000000000003630030','000000000003630019','000000000003630015','000000000003630675','000000000003630674','000000000003630673','000000000003630672','000000000003630671','000000000003633440','000000000003633439','000000000003673929','000000000003673928','000000000003674184','000000000003678494','000000000003679041','000000000003688197','000000000003693066','000000000003693626','000000000003693625','000000000003693624','000000000003693622','000000000003716258','000000000003737252','000000000003760243','000000000003760242','000000000003760241','000000000003760240','000000000003760239','000000000003760238','000000000003760237','000000000003760236','000000000003760235','000000000003760234','000000000003760233','000000000003760232','000000000003760230','000000000003760171','000000000003760169','000000000003760167','000000000003102644','000000000003102643','000000000003102642','000000000003102641','000000000003102635','000000000003102634','000000000003102633','000000000003102632','000000000003102630','000000000003102629','000000000003102628','000000000003102626','000000000003102622','000000000003102618','000000000003102617','000000000003102612','000000000003102610','000000000003102607','000000000003102606','000000000003102604','000000000003102603','000000000003102602','000000000003102601','000000000003102600','000000000003102598','000000000003102592','000000000003102524','000000000003102523','000000000003102510','000000000003102506','000000000003109885','000000000003109883','000000000003109873','000000000003109871','000000000003109870','000000000003109868','000000000003155454','000000000003161308','000000000003161287','000000000003161282','000000000003161266','000000000003260914','000000000003260913','000000000003328562','000000000003334170','000000000003334019','000000000003334018','000000000003364949','000000000003364948','000000000003365583','000000000003365582','000000000003438910','000000000003458687','000000000003572622','000000000003572621','000000000003572620','000000000003640039','000000000003640038','000000000003754132','000000000003754131','000000000003753297','000000000003794435','000000000003820438','000000000003820427','000000000003820436','000000000003234139','000000000003234138','000000000003303405','000000000003380099','000000000003399191','000000000003106210','000000000003106209','000000000003106205','000000000003106179','000000000003106178','000000000003106177','000000000003106176','000000000003106175','000000000003106170','000000000003106159','000000000003106153','000000000003106151','000000000003106149','000000000003106147','000000000003106116','000000000003106115','000000000003106114','000000000003106112','000000000003106110','000000000003106108','000000000003106107','000000000003106106','000000000003106103','000000000003106102','000000000003106100','000000000003106099','000000000003106059','000000000003106024','000000000003106013','000000000003106012','000000000003106011','000000000003105990','000000000003105989','000000000003105988','000000000003105987','000000000003105962','000000000003105961','000000000003105960','000000000003105958','000000000003105957','000000000003105948','000000000003105947','000000000003105946','000000000003105935','000000000003105934','000000000003105932','000000000003105912','000000000003105911','000000000003105910','000000000003105906','000000000003105901','000000000003105899','000000000003105898','000000000003105897','000000000003105896','000000000003105894','000000000003105893','000000000003105892','000000000003105891','000000000003105890','000000000003105889','000000000003105888','000000000003105887','000000000003105886','000000000003105885','000000000003105883','000000000003105882','000000000003105881','000000000003105880','000000000003105875','000000000003105873','000000000003105872','000000000003105868','000000000003105867','000000000003105866','000000000003105860','000000000003105859','000000000003105858','000000000003105857','000000000003105856','000000000003105855','000000000003105854','000000000003105852','000000000003105851','000000000003105845','000000000003105836','000000000003105823','000000000003105820','000000000003105818','000000000003105817','000000000003105808','000000000003105807','000000000003105806','000000000003108741','000000000003166296','000000000003166292','000000000003166279','000000000003166272','000000000003166260','000000000003166207','000000000003166205','000000000003166199','000000000003166195','000000000003166190','000000000003166184','000000000003166172','000000000003166153','000000000003166151','000000000003166149','000000000003166122','000000000003166087','000000000003166080','000000000003170173','000000000003185377','000000000003186536','000000000003186535','000000000003186534','000000000003187214','000000000003187213','000000000003187249','000000000003187246','000000000003187237','000000000003187233','000000000003191190','000000000003191189','000000000003191188','000000000003191186','000000000003191184','000000000003191183','000000000003191179','000000000003191175','000000000003193179','000000000003196878','000000000003196876','000000000003196875','000000000003196873','000000000003196871','000000000003196869','000000000003196859','000000000003196856','000000000003196853','000000000003196847','000000000003205166','000000000003205141','000000000003205122','000000000003205121','000000000003205073','000000000003205071','000000000003205057','000000000003205424','000000000003205408','000000000003205407','000000000003205393','000000000003206169','000000000003206158','000000000003206118','000000000003206111','000000000003206102','000000000003206753','000000000003208815','000000000003209288','000000000003211130','000000000003215220','000000000003214979','000000000003216884','000000000003216964','000000000003218630','000000000003218607','000000000003218606','000000000003218605','000000000003218604','000000000003218603','000000000003218906','000000000003218904','000000000003218903','000000000003218877','000000000003218875','000000000003218873','000000000003218871','000000000003220095','000000000003221042','000000000003226682','000000000003226619','000000000003226618','000000000003226617','000000000003226616','000000000003226614','000000000003226976','000000000003232280','000000000003233485','000000000003234184','000000000003234183','000000000003234182','000000000003236989','000000000003237477','000000000003245713','000000000003245712','000000000003246135','000000000003246133','000000000003248328','000000000003248326','000000000003248754','000000000003248972','000000000003248971','000000000003248970','000000000003248969','000000000003248968','000000000003248967','000000000003248965','000000000003248964','000000000003248963','000000000003248961','000000000003248949','000000000003248948','000000000003248946','000000000003248936','000000000003248935','000000000003248934','000000000003248933','000000000003248932','000000000003248931','000000000003248930','000000000003248902','000000000003248901','000000000003248900','000000000003248889','000000000003248888','000000000003248886','000000000003248885','000000000003248884','000000000003248881','000000000003252362','000000000003252360','000000000003262642','000000000003265199','000000000003265492','000000000003266239','000000000003269425','000000000003269415','000000000003269363','000000000003269362','000000000003269358','000000000003269357','000000000003269355','000000000003269354','000000000003269682','000000000003277311','000000000003278524','000000000003278523','000000000003278522','000000000003278520','000000000003278418','000000000003278416','000000000003278413','000000000003288222','000000000003303308','000000000003313079','000000000003313078','000000000003329332','000000000003332565','000000000003354078','000000000003367083','000000000003367082','000000000003367081','000000000003367080','000000000003366709','000000000003366708','000000000003376850','000000000003391545','000000000003391544','000000000003391543','000000000003391542','000000000003391455','000000000003393878','000000000003393876','000000000003431697','000000000003431695','000000000003431694','000000000003431692','000000000003431690','000000000003432813','000000000003442515','000000000003445882','000000000003445881','000000000003445880','000000000003445079','000000000003463899','000000000003463891','000000000003467545','000000000003467543','000000000003467540','000000000003478194','000000000003485063','000000000003485981','000000000003521552','000000000003521551','000000000003531860','000000000003543834','000000000003546760','000000000003546749','000000000003546747','000000000003546746','000000000003546745','000000000003546743','000000000003546742','000000000003546741','000000000003548745','000000000003548743','000000000003548742','000000000003548741','000000000003548740','000000000003548719','000000000003561494','000000000003603818','000000000003605582','000000000003605580','000000000003605760','000000000003605587','000000000003605586','000000000003612537','000000000003619079','000000000003626914','000000000003630058','000000000003663729','000000000003663728','000000000003732651','000000000003745388','000000000003745387','000000000003745384','000000000003745383','000000000003745382','000000000003745381','000000000003745682','000000000003745681','000000000003745680','000000000003745666','000000000003745663','000000000003745662','000000000003744999','000000000003744998','000000000003744997','000000000003744996','000000000003744995','000000000003744994','000000000003744993','000000000003744992','000000000003746445','000000000003746444','000000000003746443','000000000003746442','000000000003749146','000000000003749144','000000000003749143','000000000003749142','000000000003752410','000000000003769888','000000000003769884','000000000003769880','000000000003769879','000000000003769878','000000000003769870','000000000003537325','000000000003537324','000000000003794436','000000000003794434','000000000003716148','000000000003528919','000000000003763197','000000000003763195','000000000003818178','000000000003820437','000000000003820426','000000000003822517','000000000003822516','000000000003822515','000000000003822514','000000000003822513','000000000003822512','000000000003822511','000000000003823109','000000000003823951','000000000003825431','000000000003825998','000000000003827370','000000000003833127','000000000003833598','000000000003833702','000000000003833597','000000000003833700','000000000003833701','000000000003833987','000000000003833983','000000000003833985','000000000003837993','000000000003824604','000000000003824603','000000000003824602','000000000003745661','000000000003248887'
]

# Defina o caminho do arquivo de saída
output_file = 'resultadoDaConsulta.csv'

# Chame a função
search_terms_in_csv(folder_path, search_terms, output_file)